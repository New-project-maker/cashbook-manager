<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üí∞ Cashbook Manager</title>
  <style>
    body { font-family: Arial, sans-serif; background: #1e1e2f; color: white; text-align: center; }
    h1 { color: #00ffff; margin: 20px; }
    input { padding: 6px; margin: 5px; border-radius: 5px; border: none; }
    button { padding: 8px 14px; margin: 5px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
    .add-btn { background: #00bfff; color: white; }
    .clear-btn { background: #ff3333; color: white; }
    .card { display: inline-block; padding: 20px; margin: 10px; border-radius: 15px; font-size: 20px; font-weight: bold; min-width: 180px; }
    .blue { background: #2196f3; }
    .red { background: #f44336; }
    .green { background: #4caf50; }
    table { width: 95%; margin: 20px auto; border-collapse: collapse; background: #2e2e3e; }
    th, td { padding: 10px; border: 1px solid #444; }
    th { background: #444; }
    .actions button { margin: 0 3px; padding: 4px 8px; font-size: 14px; }
  </style>
</head>
<body>
  <h1>üí∞ Cashbook Manager</h1>

  <div>
    <input type="number" id="received" placeholder="Received">
    <input type="text" id="name" placeholder="Name">
    <input type="text" id="note" placeholder="Note">
    <input type="number" id="expense" placeholder="Expense">
    <button class="add-btn" onclick="addEntry()">Add Entry</button>
    <button class="clear-btn" onclick="clearAll()">Clear All</button>
  </div>

  <div>
    <div class="card blue">Total Received: <span id="totalReceived">0</span></div>
    <div class="card red">Total Expense: <span id="totalExpense">0</span></div>
    <div class="card green">Instant Balance: <span id="instantBalance">0</span></div>
  </div>

  <table id="entryTable">
    <thead>
      <tr>
        <th>Date & Time</th>
        <th>Received</th>
        <th>Name</th>
        <th>Note</th>
        <th>Expense</th>
        <th>Closing</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
const GOOGLE_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw5kcA5u2rmizMSX-nnM-2Q9v3WTnotDfY2U9LB_kL1RJ7-KpusvVbf7OLptD6iuyhQ/exec";

// ‚úÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø Google Sheet ‡¶è ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
async function addEntry() {
  const received = document.getElementById("received").value || 0;
  const name = document.getElementById("name").value;
  const note = document.getElementById("note").value;
  const expense = document.getElementById("expense").value || 0;
  const date = new Date().toLocaleString("en-GB"); // DD/MM/YYYY HH:MM
  const closing = Number(received) - Number(expense);

  const entry = { date, received, name, note, expense, closing };

  try {
    await fetch(GOOGLE_WEB_APP_URL, {
      method: "POST",
      body: JSON.stringify(entry)
    });
    loadEntries(); // ‚úÖ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì
  } catch (err) {
    console.error("Add error:", err);
  }
}

// ‚úÖ ‡¶∏‡¶¨ ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø Google Sheet ‡¶•‡ßá‡¶ï‡ßá ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
async function loadEntries() {
  try {
    const res = await fetch(GOOGLE_WEB_APP_URL);
    const data = await res.json();

    const tbody = document.querySelector("#entryTable tbody");
    tbody.innerHTML = "";

    let totalReceived = 0, totalExpense = 0;

    data.forEach(entry => {
      const row = tbody.insertRow();
      row.insertCell().innerText = entry.date;
      row.insertCell().innerText = entry.received;
      row.insertCell().innerText = entry.name;
      row.insertCell().innerText = entry.note;
      row.insertCell().innerText = entry.expense;
      row.insertCell().innerText = entry.closing;

      totalReceived += Number(entry.received) || 0;
      totalExpense += Number(entry.expense) || 0;
    });

    document.getElementById("totalReceived").innerText = totalReceived;
    document.getElementById("totalExpense").innerText = totalExpense;
    document.getElementById("instantBalance").innerText = totalReceived - totalExpense;

  } catch (err) {
    console.error("Load error:", err);
  }
}

// ‚úÖ Clear All (‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßá, Sheet ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶æ)
function clearAll() {
  document.querySelector("#entryTable tbody").innerHTML = "";
  document.getElementById("totalReceived").innerText = 0;
  document.getElementById("totalExpense").innerText = 0;
  document.getElementById("instantBalance").innerText = 0;
}

window.onload = loadEntries;
</script>
</body>
</html>
